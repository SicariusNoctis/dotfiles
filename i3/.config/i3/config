# i3 config file (v4)

### USER VARIABLES ###

# Main modifier keys
set $mod  Mod4
set $mod_ Mod1

# Named workspaces
#               
set $ws1   "1:"
set $ws2   "2:"
set $ws3   "3:"
set $ws4   "4:"
set $ws5   "5:5"
set $ws6   "6:6"
set $ws7   "7:7"
set $ws8   "8:8"
set $ws9   "9:"
set $ws10  "10:10"
set $ws666 "666:"

# Flags
set $nsi            --no-startup-id

# Wallpaper paths
set $wallpaper      /usr/share/backgrounds/000current.jpg
set $lock_wallpaper /usr/share/backgrounds/001current.png

# Common style options
set $rofi_style     -lines 10 -hide-scrollbar -separator-style none -line-padding 4 -bw 2 -font 'Roboto Mono 14' -kb-row-select 'Tab' -kb-row-tab ''

# File search
# Create database:  updatedb --require-visibility 0 -o ~/.locate.db
set $list_files     locate -d ~/.locate.db $HOME/Downloads /mnt/data | \
                    grep -vP '^/mnt/data/((code/OpenCV-android-sdk)|(Dropbox/((Apps/)|(Backup/Android/)|(Camera Uploads/.*\..*$)))|(Games/)|(matlab_install/)).*$' | \
                    grep -vP '^/mnt/data2/((ProgFiles/)).*$' | \
                    grep -vP '/\.'

# Folder search
# Download scripts from https://github.com/SicariusNoctis/frequency-index-scripts
set $list_folders   ~/code/frequency-index-scripts/list_index.sh   ~/.dir_index.txt ~/.dir_frequent.txt
set $update_folders ~/code/frequency-index-scripts/update_freq.sh                   ~/.dir_frequent.txt
set $update_index   ~/code/frequency-index-scripts/update_index.sh ~/.dir_index.txt ~/.dir_frequent.txt

# Sound control
set $amixer         amixer -q -D pulse set Master
set $vol_change     pkill -SIGRTMIN+1 i3blocks


### DEFAULT BINDINGS ###

# Kill window
bindsym $mod+Shift+q            kill

# Terminal
bindsym $mod+Return             exec termite

# Focus window
bindsym $mod+h                  focus left
bindsym $mod+j                  focus down
bindsym $mod+k                  focus up
bindsym $mod+l                  focus right

bindsym $mod+Left               focus left
bindsym $mod+Down               focus down
bindsym $mod+Up                 focus up
bindsym $mod+Right              focus right

# Move window
bindsym $mod+Shift+h            move left
bindsym $mod+Shift+j            move down
bindsym $mod+Shift+k            move up
bindsym $mod+Shift+l            move right

bindsym $mod+Shift+Left         move left
bindsym $mod+Shift+Down         move down
bindsym $mod+Shift+Up           move up
bindsym $mod+Shift+Right        move right

# Split
bindsym $mod+v                  split v
bindsym $mod+Shift+v            split h

# Fullscreen
bindsym $mod+f                  fullscreen toggle

# Layout
bindsym $mod+s layout           stacking
bindsym $mod+w layout           tabbed
bindsym $mod+e layout           toggle split

# Floating
bindsym $mod+Shift+space        floating toggle

# Focus floating
bindsym $mod+space              focus mode_toggle

# Focus parent
bindsym $mod+a                  focus parent

# Focus child
bindsym $mod+Shift+a            focus child

# Workspace switching
bindsym $mod+1                  workspace $ws1
bindsym $mod+2                  workspace $ws2
bindsym $mod+3                  workspace $ws3
bindsym $mod+4                  workspace $ws4
bindsym $mod+5                  workspace $ws5
bindsym $mod+6                  workspace $ws6
bindsym $mod+7                  workspace $ws7
bindsym $mod+8                  workspace $ws8
bindsym $mod+9                  workspace $ws9
bindsym $mod+0                  workspace $ws10

# Move to workspace
bindsym $mod+Shift+1            move container to workspace $ws1;  workspace $ws1
bindsym $mod+Shift+2            move container to workspace $ws2;  workspace $ws2
bindsym $mod+Shift+3            move container to workspace $ws3;  workspace $ws3
bindsym $mod+Shift+4            move container to workspace $ws4;  workspace $ws4
bindsym $mod+Shift+5            move container to workspace $ws5;  workspace $ws5
bindsym $mod+Shift+6            move container to workspace $ws6;  workspace $ws6
bindsym $mod+Shift+7            move container to workspace $ws7;  workspace $ws7
bindsym $mod+Shift+8            move container to workspace $ws8;  workspace $ws8
bindsym $mod+Shift+9            move container to workspace $ws9;  workspace $ws9
bindsym $mod+Shift+0            move container to workspace $ws10; workspace $ws10

# Restart/reload i3
bindsym $mod+Shift+r            restart

# Resize window
bindsym $mod+r                  mode "resize"


### USER BINDINGS ###

# Mouse (scroll wheel) bindings
bindsym --whole-window --border $mod+Button4        workspace prev
bindsym --whole-window --border $mod+Button5        workspace next
bindsym --whole-window --border $mod+Shift+Button4  focus left
bindsym --whole-window --border $mod+Shift+Button5  focus right
bindsym --whole-window --border $mod+Ctrl+Button4   exec $nsi $amixer 1%+ && $vol_change
bindsym --whole-window --border $mod+Ctrl+Button5   exec $nsi $amixer 1%- && $vol_change
bindsym --border                Button2             kill

# Workspace switch back/forth
bindsym $mod+grave              workspace back_and_forth

# Workspace switch back/forth and move
bindsym $mod+shift+grave        move container to workspace back_and_forth; workspace back_and_forth

# TODO
# Alt+tab like window switching back/forth
bindsym $mod_+grave             focus right

# Next/previous windows
bindsym $mod_+Tab               focus right
bindsym $mod_+Shift+Tab         focus left

# Workspace cycling
bindsym $mod+Tab                workspace next
bindsym $mod+Ctrl+h             workspace prev
bindsym $mod+Ctrl+l             workspace next
bindsym $mod+Ctrl+Left          workspace prev
bindsym $mod+Ctrl+Right         workspace next

# Workspace cycling and moving
bindsym $mod+Shift+Tab          move container to workspace next; workspace next
bindsym $mod+Ctrl+Shift+h       move container to workspace prev; workspace prev
bindsym $mod+Ctrl+Shift+l       move container to workspace next; workspace next
bindsym $mod+Ctrl+Shift+Left    move container to workspace prev; workspace prev
bindsym $mod+Ctrl+Shift+Right   move container to workspace next; workspace next

# Gaps
bindsym $mod+period             gaps inner all plus  5
bindsym $mod+Shift+period       gaps inner all minus 5
bindsym $mod+slash              gaps outer all plus  5
bindsym $mod+Shift+slash        gaps outer all minus 5

# Volume control
bindsym XF86AudioLowerVolume    exec $nsi $amixer 5%-    && $vol_change
bindsym XF86AudioRaiseVolume    exec $nsi $amixer 5%+    && $vol_change
bindsym XF86AudioMute           exec $nsi $amixer toggle && $vol_change

bindsym $mod+z                  exec $nsi $amixer 5%+    && $vol_change
bindsym $mod+Shift+z            exec $nsi $amixer 5%-    && $vol_change
bindsym $mod+Ctrl+Shift+z       exec $nsi $amixer toggle && $vol_change

bindsym $mod+comma              exec $nsi $amixer 1%+    && $vol_change
bindsym $mod+Shift+comma        exec $nsi $amixer 1%-    && $vol_change

# Media control
bindsym XF86AudioPlay           exec $nsi playerctl play-pause
bindsym XF86AudioPause          exec $nsi playerctl pause
bindsym XF86AudioNext           exec $nsi playerctl next
bindsym XF86AudioPrev           exec $nsi playerctl prev

bindsym $mod+Ctrl+z             exec $nsi playerctl play-pause

# GPMDP control
bindsym $mod+$mod_+ctrl+z       exec $nsi qdbus org.mpris.MediaPlayer2.google-play-music-desktop-player /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
bindsym $mod+$mod_+z            exec $nsi ~/.config/i3/scripts/gpmdp_vol + 0.05
bindsym $mod+$mod_+shift+z      exec $nsi ~/.config/i3/scripts/gpmdp_vol - 0.05

# rofi (app launcher, sudo app launcher, file search, folder search, window jumper)
bindsym $mod+q                  exec "rofi $rofi_style -p 'run'        -combi-modi drun,run -show combi -modi combi"
bindsym $mod+Ctrl+q             exec "rofi $rofi_style -p 'run (sudo)' -combi-modi drun,run -show combi -modi combi -run-command 'gksudo {cmd}'"
bindsym $mod+d                  exec "$list_files   | rofi $rofi_style -p 'files'   -dmenu -i -levenshtein-sort | xargs -I {} gio open {}"
bindsym $mod+Ctrl+d             exec "$list_folders | rofi $rofi_style -p 'folders' -dmenu -i -levenshtein-sort | (read x; [[ -z \\"$x\\" ]] || (gio open \\"$x\\"; $update_folders \\"$x\\"; $update_index \\"$x\\"))"
bindsym $mod+Shift+d            exec "wmctrl -l     | rofi $rofi_style -p 'window'  -dmenu -i -levenshtein-sort | cut -d ' ' -f1 | xargs -I {} i3-msg '[id=\\"{}\\"] focus'"

# Cycle border
bindsym $mod+b                  border toggle
bindsym $mod+Shift+b            border normal

# Jump to urgent window
bindsym $mod+x                  [urgent=latest] focus

# Lock screen
bindsym $mod+Shift+x            exec $nsi ~/.config/i3/scripts/lock $ws666 $lock_wallpaper

# Make window a scratchpad
bindsym $mod+Shift+minus        move scratchpad

# Show scratchpad window
bindsym $mod+minus              scratchpad show

# Shortcuts: open/switch to
bindsym $mod+$mod_+f            exec wmctrl -xa firefox
bindsym $mod+$mod_+g            exec wmctrl -xa "Google Play Music Desktop Player"
bindsym $mod+$mod_+o            exec wmctrl -xa okular
bindsym $mod+$mod_+s            exec wmctrl -xa subl

# Thunar
bindsym $mod+t                  exec thunar

# Thunar > Downloads
bindsym $mod+Shift+t            exec thunar ~/Downloads

# Python terminal (i.e. calculator)
bindsym $mod+c                  exec $nsi termite -e ptpython  -t "python scratchpad"
bindsym $mod+shift+c            exec $nsi termite -e ptipython -t "ipython scratchpad"

# termite transparency
bindsym $mod+semicolon          exec $nsi ~/.config/i3/scripts/termite_transparency ' + 0.01'
bindsym $mod+Shift+semicolon    exec $nsi ~/.config/i3/scripts/termite_transparency ' - 0.01'

# Redshift control
bindsym $mod+m                  exec $nsi rs $(($(cat ~/.rshift) + 200))
bindsym $mod+Shift+m            exec $nsi rs $(($(cat ~/.rshift) - 200))
bindsym $mod+Ctrl+m             exec $nsi rs 4000
bindsym $mod+Ctrl+Shift+m       exec $nsi rs 6500

# Resize window
bindsym $mod+$mod_+h            resize shrink width   10 px or  10 ppt
bindsym $mod+$mod_+j            resize grow   height  10 px or  10 ppt
bindsym $mod+$mod_+k            resize shrink height  10 px or  10 ppt
bindsym $mod+$mod_+l            resize grow   width   10 px or  10 ppt

bindsym $mod+$mod_+Left         resize shrink width   10 px or  10 ppt
bindsym $mod+$mod_+Down         resize grow   height  10 px or  10 ppt
bindsym $mod+$mod_+Right        resize grow   width   10 px or  10 ppt
bindsym $mod+$mod_+Up           resize shrink height  10 px or  10 ppt

bindsym $mod+$mod_+Shift+h      resize shrink width    1 px or   1 ppt
bindsym $mod+$mod_+Shift+j      resize grow   height   1 px or   1 ppt
bindsym $mod+$mod_+Shift+k      resize shrink height   1 px or   1 ppt
bindsym $mod+$mod_+Shift+l      resize grow   width    1 px or   1 ppt

bindsym $mod+$mod_+Shift+Left   resize shrink width    1 px or   1 ppt
bindsym $mod+$mod_+Shift+Down   resize grow   height   1 px or   1 ppt
bindsym $mod+$mod_+Shift+Up     resize shrink height   1 px or   1 ppt
bindsym $mod+$mod_+Shift+Right  resize grow   width    1 px or   1 ppt

bindsym $mod+$mod_+Ctrl+h       resize shrink width  100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+j       resize grow   height 100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+k       resize shrink height 100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+l       resize grow   width  100 px or 100 ppt

bindsym $mod+$mod_+Ctrl+Left    resize shrink width  100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+Down    resize grow   height 100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+Up      resize shrink height 100 px or 100 ppt
bindsym $mod+$mod_+Ctrl+Right   resize grow   width  100 px or 100 ppt

# Center window
bindsym $mod+$mod_+c            move position center


### DEFAULT MODES ###

# Resize window
mode "resize" {
    bindsym h                   resize shrink width   10 px or  10 ppt
    bindsym j                   resize grow   height  10 px or  10 ppt
    bindsym k                   resize shrink height  10 px or  10 ppt
    bindsym l                   resize grow   width   10 px or  10 ppt

    bindsym Left                resize shrink width   10 px or  10 ppt
    bindsym Down                resize grow   height  10 px or  10 ppt
    bindsym Right               resize grow   width   10 px or  10 ppt
    bindsym Up                  resize shrink height  10 px or  10 ppt

    bindsym Shift+h             resize shrink width    1 px or   1 ppt
    bindsym Shift+j             resize grow   height   1 px or   1 ppt
    bindsym Shift+k             resize shrink height   1 px or   1 ppt
    bindsym Shift+l             resize grow   width    1 px or   1 ppt

    bindsym Shift+Left          resize shrink width    1 px or   1 ppt
    bindsym Shift+Down          resize grow   height   1 px or   1 ppt
    bindsym Shift+Up            resize shrink height   1 px or   1 ppt
    bindsym Shift+Right         resize grow   width    1 px or   1 ppt

    bindsym Ctrl+h              resize shrink width  100 px or 100 ppt
    bindsym Ctrl+j              resize grow   height 100 px or 100 ppt
    bindsym Ctrl+k              resize shrink height 100 px or 100 ppt
    bindsym Ctrl+l              resize grow   width  100 px or 100 ppt

    bindsym Ctrl+Left           resize shrink width  100 px or 100 ppt
    bindsym Ctrl+Down           resize grow   height 100 px or 100 ppt
    bindsym Ctrl+Up             resize shrink height 100 px or 100 ppt
    bindsym Ctrl+Right          resize grow   width  100 px or 100 ppt

    bindsym Return              mode "default"
    bindsym Escape              mode "default"
}


### USER CUSTOMIZATIONS ###

font                          pango:Noto Mono Regular, Awesome 8
floating_modifier             $mod
focus_follows_mouse           no
hide_edge_borders             both
new_window                    none
workspace_auto_back_and_forth yes
workspace_layout              tabbed

# Colors
# class                 border  backgr. text    indicator child_border
client.focused          #441122 #441122 #ffffff #442211   #442211
client.focused_inactive #5f676a #5f676a #ffffff #333333   #333333
client.unfocused        #222222 #222222 #888888 #292d2e   #222222
client.urgent           #2f343a #900000 #ffffff #900000   #900000
client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c

client.background       #333333

# Default window settings
for_window [title="^i?python scratchpad$"] \
    floating enable, border none, \
    resize set 600 232, move position 0 20, \
    move scratchpad, scratchpad show

for_window [title="^Cadence$"] floating enable, resize set 800 600, move position center

for_window [title="^Guitarix: gx_head$"] floating enable, border none, move position center

for_window [title="Mozilla Firefox"] border none

# Default workspace locations
assign [class="discord"]                          → $ws1
assign [class="Firefox"]                          → $ws1
assign [class="Guitarix"]                         → $ws3
assign [class="GalaxyClient.exe"]                 → $ws4
assign [class="Gwent.exe"]                        → $ws4
assign [class="League of Legends.exe"]            → $ws4
assign [class="LeagueClientUx.exe"]               → $ws4
assign [class="leagueclientux.exe"]               → $ws4
assign [class="Lutris"]                           → $ws4
#assign [class="mpv"]                              → $ws4
assign [class="qBittorrent"]                      → $ws4
#assign [class="Vlc"]                              → $ws4
assign [class="Google Play Music Desktop Player"] → $ws9


### USER STARTUP ###

# System
exec        $nsi     compton
exec        $nsi     xmodmap ~/.Xmodmap
exec        $nsi     xset led on
exec_always $nsi     xinput --set-prop $(xinput list --short | grep "Razer Abyssus" | sed 's/.*id=\([0-9]\+\).*/\1/') 'libinput Accel Speed' -0.6

# Fast startup
exec        $nsi     /usr/local/bin/lightsOn/lightsOn.sh 300
exec_always $nsi     feh --bg-scale $wallpaper
exec_always $nsi     ~/.config/polybar/polybar.sh

# Medium startup
exec        $nsi     "sleep 1 && copyq"
exec        $nsi     rescuetime
exec        $nsi     screencloud
exec        $nsi     tilda

# Slow startup
exec        $nsi     "sleep 10 && alsa_out -j 'speakers' -d speakers"
exec        $nsi     "sleep 15 && jack_connect 'PulseAudio JACK Sink-01:front-left'  'speakers:playback_1'"
exec        $nsi     "sleep 15 && jack_connect 'PulseAudio JACK Sink-01:front-right' 'speakers:playback_2'"
exec        $nsi     "sleep 15 && jack_connect 'PulseAudio JACK Sink:front-left'     'speakers:playback_1'"
exec        $nsi     "sleep 15 && jack_connect 'PulseAudio JACK Sink:front-right'    'speakers:playback_2'"
exec        $nsi     "sleep 5 && cadence-session-start --system-start"

exec        $nsi     dropbox


### TODO ###

# Unused bindings:
# $mod+g
# $mod+i
# $mod+n
# $mod+o
# $mod+p
# $mod+u
# $mod+y
# $mod+Shift+e
# $mod+Shift+f
# $mod+Shift+g
# $mod+Shift+s
# $mod+Shift+v
# $mod+Shift+w
# $mod+Shift+y

# Rarely used bindings:
# $mod+a
# $mod+e
# $mod+r
# $mod+s
# $mod+t
# $mod+w
# $mod+x

# Highly used bindings (that are hard to reach):
# $mod+$mod_+g
# $mod+shift+t
# F1

# rofi emoji
# Rename Shift/Ctrl to shift/ctrl?
# vim-like mark window with keybind

# Alt-tabbing (focus last)
# Perhaps save previous window ID when selecting between different windows
# https://www.reddit.com/r/i3wm/comments/3o2bdn/i3_how_to_quickly_switch_between_current_and/?st=j4hmby3s&sh=1dc36d16

